services:
  # gateway:
  #   image: caddy:2.10-alpine
  #   ports:
  #     - 8888:80
  #   volumes:
  #     - ./etc/caddy:/etc/caddy
  #     - caddy-vol:/data

  server:
    ports:
      - 8888:8888
    build:
      dockerfile: ./monolith/Dockerfile
      target: devel
    volumes:
      - ./account:/kochira/account
      - ./monolith:/kochira/monolith
      - ./lib:/kochira/lib
    env_file: 
      - path: "./account/.env"
        required: true
  db:
    image: postgres:alpine
    volumes:
      - db-vol:/var/lib/postgresql
    environment:
      POSTGRES_USER: kochira
      POSTGRES_DB: kochira
      POSTGRES_PASSWORD: beats_me
  cache:
    image: valkey/valkey:alpine
    volumes:
      - cache-vol:/data



volumes:
  db-vol:
  cache-vol:
  # caddy-vol: